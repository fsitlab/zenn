# 技術と層の対応早見表

> 5層モデルにおける各技術/規格の関係性を「主体」と「利用」の2軸で整理

---

## 凡例

| 記号 | 意味 |
|:--:|:--|
| **✅** | **主体（Define）** - その技術の中心となる層。定義・実装の本体 |
| **🔧** | **利用（Use）** - その技術が利用する機能、または影響を与える層 |
| `-` | 関係なし（素通し含む） |

---

## 5層モデル（参照）

```
第5層：UI・運用層              - ユーザーとの接点（UI）+ LLMに直接関係しない周辺機能
                                （監視、ログ分析、ユーザー管理、認証・認可の基本部分）
第4層：外部ツール層            - ベクトルDB、MCPサーバー、サブエージェント
第3層：LLMオーケストレーション層 - 直接LLMとやり取りする層
                                （ワークフロー、Hooks、MCPクライアント、エージェントランタイム）
第2層：通信層                  - A: クライアント起点 / B: LLM起点
第1層：LLM層                   - モデル、パラメータ、JSON構造
```

---

## 早見表

| 技術/規格 | 第5層(UI・運用) | 第4層(ツール) | 第3層(LLMオーケストレーション) | 第2層A(Client) | 第2層B(LLM) | 第1層(LLM) | 備考 |
|:--|:--:|:--:|:--:|:--:|:--:|:--:|:--|
| **── LLM基盤技術 ──** |
| LoRA | - | - | - | - | - | **✅** | モデル重みの低ランク調整 |
| ファインチューニング | - | - | - | - | - | **✅** | モデル重みの直接更新 |
| モデル系列（Claude/GPT等） | - | - | - | - | - | **✅** | 各社のベースモデル |
| **── パラメータ ──** |
| temperature / top_k / top_p | - | - | - | - | - | **✅** | 確率的振る舞いの制御 |
| max_tokens | - | - | - | - | - | **✅** | 出力長制限 |
| Extended Thinking | - | - | - | - | - | **✅** | 思考プロセス出力 |
| Prompt Caching | - | - | - | - | - | **✅** | キャッシュ制御タグ |
| **── プロンプト工学 ──** |
| system prompt | - | - | - | **✅** | - | 🔧 | Clientが送信、LLMが受信 |
| プロンプトチューニング | - | - | - | **✅** | - | 🔧 | 2層Aで設計、1層に影響 |
| **── ツール利用 ──** |
| ツール宣言（tools[]） | - | - | - | **✅** | - | 🔧 | Clientが宣言、LLMが読む |
| ツール利用判断（tool_use） | - | - | - | 🔧 | **✅** | 🔧 | LLMが出力、Clientが受信 |
| ツール実行 | - | 🔧 | **✅** | - | - | - | 3層が4層ツールを実行 |
| ツールの外部プログラム動作 | - |　**✅** | 🔧 | - | - | - | 外部プログラムが動作し、結果返却|
| **── MCP ──** |
| MCP（プロトコル全体） | - | **✅** | **✅** | 🔧 | - | - | 3層-4層間を定義 |
| MCPサーバー | - | **✅** | - | - | - | - | 外部ツールとして提供 |
| MCPクライアント | - | - | **✅** | 🔧 | - | - | tools[]変換を担当 |
| .mcp.json | - | - | **✅** | - | - | - | 設定ファイル |
| MCP経由のツール実行 | - | **✅** |**✅** | 🔧 | **✅** | 🔧 | LLMが出力、3層が受信してツール実行 |
| **── RAG ──** |
| 従来型RAG | - | 🔧 | **✅** | **✅** | - | - | 3層が4層を使い2層Aに注入 |
| ツール型RAG | - | **✅** | 🔧 | 🔧 | **✅** | 🔧 | LLMが主体的に検索 |
| ベクトルDB | - | **✅** | 🔧 | - | - | - | 4層の実装、3層が利用 |
| **── Claude Code固有 ──** |
| CLAUDE.md | - | - | 🔧 | **✅** | - | - | 3層が読み込み2層Aに展開 |
| Skill（定義） | - | - | **✅** | 🔧 | - | - | 3層でロード、2層Aに注入 |
| Skill（ロード後） | - | - | - | **✅** | - | - | プロンプトとして展開済み |
| Hooks | - | - | **✅** | - | - | - | 決定論的制御（LLM操作にフィードバック） |
| Permissions | - | - | **✅** | - | - | - | 権限管理（LLM操作に波及する場合） |
| **── マルチエージェント ──** |
| サブエージェント | - | **✅** | 🔧 | 🔧 | 🔧 | 🔧 | 4層で実行、全層に影響 |
| Agent Teams | - | 🔧 | **✅** | 🔧 | - | - | 3層で設計、4層を束ねる |
| A2A（エージェント間通信） | - | **✅** | 🔧 | 🔧 | - | - | 4層間の通信プロトコル |
| **── UI・運用 ──** |
| Kiro（AI IDE） | **✅** | **✅** | **✅** | 🔧 | 🔧 | 🔧 | UI（5層）+オーケストレーション（3層）＋ファイル編集・テスト実行（4層） |
| VSCode + AI拡張 | **✅** | - | 🔧 | - | - | - | UI（5層）として3層を利用 |
| Claude.ai | **✅** | - | - | - | - | - | UI（5層）のみ、3層はクラウド側 |
| Cursor | **✅** | - | **✅** | 🔧 | 🔧 | 🔧 | UI（5層）+オーケストレーション（3層） |
| Dify | **✅** | 🔧 | **✅** | 🔧 | 🔧 | 🔧 | UI（5層）+ワークフロー（3層）+ツール（4層） |
| 監視・ログ分析 | **✅** | - | - | - | - | - | LLMに直接関係しない周辺機能 |
| ユーザー管理 | **✅** | - | - | - | - | - | LLMに直接関係しない周辺機能 |
| ユーザ認証・認可（基本） | **✅** | - | - | - | - | - | ※権限制御でLLM操作に波及→3層 |

---

## 読み方のポイント

### ✅の位置 = その技術の本体

- **LoRA**: ✅が1層のみ → モデル内部で完結、他層に影響しない
- **MCP**: ✅が3層と4層 → MCPはLLMオーケストレーション層と外部ツール層の間を定義
- **Kiro**: ✅が3層、4層、5層 → UI・運用（5層）とLLMオーケストレーション（3層）、ファイル読み書き・テスト実行（4層）の全てを持つ

### 🔧の位置 = その技術が利用する機能

- **ツール利用判断**: ✅が2層B（LLM起点）、🔧が2層A（Clientに返る）と1層（LLM機能依存）
- **ツール型RAG**: ✅が2層B（LLM主導）と4層（DB）、🔧が広範囲に影響

### UIだけのサービス（Claude.ai等）

- ✅が5層のみ、🔧なし → ユーザーインターフェースとして機能
- 3層のランタイムはクラウド側（Anthropic）が持つ

---

## 層別：何が属するか

### 第1層（LLM層）で完結するもの
- LoRA、ファインチューニング
- temperature、top_k、max_tokens
- Extended Thinking、Prompt Caching

### 第2層A（クライアント起点）で定義されるもの
- system prompt
- ツール宣言（tools[]）
- CLAUDE.md、Skill（展開後）
- プロンプトチューニング

### 第2層B（LLM起点）で定義されるもの
- ツール利用判断（tool_use）
- ツール型RAGの検索要求

### 第3層（LLMオーケストレーション層）で定義されるもの
- ツール実行
- MCPクライアント、Hooks、Permissions
- ワークフロー（LLM操作）
- エージェントランタイム
- Skill（定義・ロード制御）
- 従来型RAG（パイプライン）
- Agent Teams（設計）

### 第4層（外部ツール層）で定義されるもの
- MCPサーバー
- ベクトルDB
- サブエージェント
- A2Aエージェント
- ローカルファイル読み書き
- コマンド実行、AIによるPC画面操作
- サンドボックス環境

### 第5層（UI・運用層）で定義されるもの
- VSCode、Cursor（UI部分）
- Claude.ai、ChatGPT
- Dify（UI部分）
- 監視・ログ分析
- ユーザー管理
- ユーザ認証・認可（基本部分）※権限制御でLLM操作に波及する場合は第3層

---

## 相性問題と層の関係

| 問題 | 関係する層 | 原因 |
|--|--|--|
| APIフォーマット不一致 | 1層 | ベンダー間のJSON形式差 |
| tool descriptionが貧弱 | 2層A→2層B | LLMがツールを使わない |
| MCPスキーマ不正 | 3層↔4層 | サーバー実装のJSON誤り |
| CLAUDE.mdが巨大 | 2層A | コンテキスト汚染 |
| 従来RAGとTool型RAGの混同 | 2層A vs 2層B | 主体が異なる |
| フレームワーク間通信 | 3層↔4層 | A2A未対応 |

---

*作成日: 2026-02-22*
*対応モデル: 5層モデル*
