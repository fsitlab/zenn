# AIエージェント概念マップ：5層構造マッピング表

> **5層構造の定義**
> - 第1層：LLM層 - LLMとの通信プロトコル（JSON構造・パラメータ）
> - 第2層：通信層 - A: クライアント起点（Tool Use等）、B: LLM起点（tool_use出力等）
> - 第3層：アプリ層 - LLMを呼び出すランタイム・フレームワーク
> - 第4層：外部ツール層 - 外部サービス・データベース・MCP等
> - 第5層：プレゼンテーション層 - ユーザーインターフェース・IDE・アプリケーション

*作成日: 2026-02-22*
*元ファイル: ai-agent-concept-map-references.md, 追記A改訂版_4層モデル.md, 追記候補_エージェントアーキテクチャとAgentTeams.md, 追記候補_概念補完.md*

---

## 1. 概念マッピング表（全体）

| 概念 | 第1層(LLM) | 第2層A(Client起点) | 第2層B(LLM起点) | 第3層(アプリ) | 第4層(外部ツール) | 第5層(プレゼンテーション) | 備考 |
|------|:----------:|:------------------:|:---------------:|:-------------:|:-----------------:|:------------------------:|------|
| **LLM通信パラメータ** |
| temperature / top_p / top_k | ✅ | | | | | | JSONパラメータ |
| max_tokens / stop | ✅ | | | | | | 出力制御 |
| model名 / role | ✅ | | | | | | 基本構造 |
| content[]ブロック | ✅ | | | | | | text/image/tool_use等 |
| messages[]配列 | ✅ | | | | | | 会話履歴 |
| **拡張機能（①層）** |
| Extended Thinking | ✅ | | | | | | thinkingブロック出力 |
| Prompt Caching | ✅ | | | | | | cache_controlタグ |
| Batch API | ✅ | | | | | | 非同期バッチ処理 |
| Structured Output / JSON Schema | ✅ | | | | | | 出力形式強制 |
| ストリーミング（SSE/WebSocket） | ✅ | | | | | | リアルタイム出力 |
| **Tool Use関連** |
| tools[]定義（JSON構造） | ✅ | | | | | | スキーマ定義 |
| tool_use出力（LLM→Host） | | | ✅ | | | | LLM起点の呼び出し要求 |
| tool_result入力（Host→LLM） | | ✅ | | | | | クライアント起点の結果返却 |
| tool_use実行 | | | | ✅ | | | アプリ層が実行 |
| **MCP関連** |
| MCPサーバー | | | | | ✅ | | 外部ツール提供 |
| MCPクライアント | | | | ✅ | | | tools[]変換の橋渡し |
| `.mcp.json` | | | | ✅ | | | 設定ファイル |
| tools/list（MCP） | | ✅ | | | | | クライアント起点のツール取得 |
| tools/call（MCP） | | ✅ | | | | | クライアント起点のツール実行 |
| リモートMCP（HTTP/SSE） | | ✅ | | | ✅ | | 両層にまたがる |
| **プロンプト関連** |
| system prompt | ✅ | | | | | | リクエストJSON内 |
| CLAUDE.md / AGENTS.md | | ✅ | | | | | クライアントがpromptに注入 |
| Skill（SKILL.md） | | ✅ | | | | | 動的プロンプト拡張 |
| **RAG関連** |
| 従来型RAG（結果注入） | | ✅ | | ✅ | | | クライアントが機械的に注入 |
| Tool型RAG（LLM主導） | ✅ | | ✅ | ✅ | ✅ | | 複数層にまたがる |
| ベクトルDB / 検索エンジン | | | | | ✅ | | 外部ツール |
| Embedding Model | | | | ✅ | | | ベクトル化処理 |
| **制御機構** |
| Hooks | | | | ✅ | | | 決定論的制御 |
| PreToolUse（ブロック可能） | | | | ✅ | | | exit 2でブロック |
| Permissions / permissionMode | | | | ✅ | | | 権限管理 |
| **エージェント関連** |
| Subagent（Taskツール呼び出し） | ✅ | ✅ | ✅ | ✅ | | | 全層にまたがる |
| Agent Teams（タスクボード） | | | | ✅ | | | 内部タスク管理 |
| Agent Teams（SendMessage） | | | | ✅ | | | エージェント間通信 |
| A2A（JSON-RPC 2.0） | | ✅ | | | ✅ | | HTTP通信プロトコル |
| Agent Card | | | | | ✅ | | エージェント発見 |
| **フレームワーク** |
| LangChain | | | | ✅ | | | LLM呼び出しランタイム |
| LlamaIndex | | | | ✅ | | | RAG特化フレームワーク |
| Strands Agents（AWS） | | | | ✅ | | | AWSエージェント基盤 |
| LangGraph | | | | ✅ | | | グラフベース制御 |
| AutoGen | | | | ✅ | | | マルチエージェント |
| **プレゼンテーション層** |
| VS Code  | | | | | | ✅ | IDE |
| Amazon Kiro  | | | |✅| |✅ | AI IDE |
| Claude Code | | | | ✅ | | | UIレスのCLI |
| Cursor | | | | ✅ | | ✅ | アプリ+UI両面 |
| Dify / n8n | | | | ✅ | | ✅ | ノーコード基盤 |
| Claude.ai | | | | | | ✅ | Webインターフェース |
| **Computer Use** |
| Computer Use（tool定義） | ✅ | | | | | | ツール定義 |
| Computer Use（実行） | | | | ✅ | | | 画面操作 |
| Computer Use（screenshot） | | ✅ | | | | | 結果を画像で返却 |
| **OSSモデル関連** |
| HuggingFace Hub | | | | | ✅ | | モデルリポジトリ |
| TGI / vLLM / Ollama | | | | ✅ | | | サービング |
| LiteLLM | | | | ✅ | | | API統一ラッパー |

---

## 2. 層別詳細

### 第1層：LLM層

LLMへのリクエスト/レスポンスJSONのフィールド構造そのもの。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| temperature / top_p / top_k | 出力のランダム性制御 | 元記事 第0章 |
| max_tokens / stop | 出力制限パラメータ | 元記事 第0章 |
| model / role / content[] | 基本JSON構造 | 元記事 第1章 |
| Extended Thinking | thinkingブロック出力 | 追記候補_概念補完.md |
| Prompt Caching | cache_controlタグ | 追記候補_概念補完.md |
| Batch API | 非同期バッチ処理 | 追記候補_概念補完.md |
| Structured Output | response_format / JSON Schema | 追記候補_概念補完.md |
| ストリーミング | SSE / WebSocket | 元記事 第1章 |
| tools[]定義 | ツールスキーマ（JSON構造として） | 元記事 第2章 |
| system prompt | systemフィールド | 元記事 第1章 |

---

### 第2層：通信層

#### 第2層A：クライアント起点

ホスト/クライアントがLLMに対して能動的に送信する通信。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| tool_result | ツール実行結果をLLMに返す | 元記事 第2章 |
| CLAUDE.md / AGENTS.md | セッション開始時にsystem promptへ注入 | 元記事 第5章 |
| Skill（ロード） | タスク発生時にプロンプトをロード | 元記事 第6章 |
| 従来型RAG結果注入 | 検索結果をpromptに埋め込む | 元記事 第4章 |
| MCP tools/list | サーバーからツール一覧を取得 | 元記事 第3章 |
| MCP tools/call | サーバーのツールを実行 | 元記事 第3章 |
| A2A JSON-RPC呼び出し | 他エージェントへのHTTPリクエスト | 追記候補_エージェントアーキテクチャ |
| Computer Use結果返却 | スクリーンショットをtool_resultで返す | 追記候補_概念補完.md |

#### 第2層B：LLM起点

LLMが出力として返す通信要求。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| tool_use出力 | LLMがツール呼び出しを要求 | 元記事 第2章 |
| Tool型RAGの検索要求 | LLMが能動的に検索ツールを呼ぶ | 元記事 第4章 |
| Subagent起動要求 | Taskツールのtool_use | 元記事 第8章 |

---

### 第3層：アプリ層

LLMを直接呼び出すランタイム・フレームワーク。プログラムが保証する決定論的制御。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| tool_use実行 | LLMの要求を受けてツールを実行 | 元記事 第2章 |
| MCPクライアント | tools[]への変換を担当 | 元記事 第3章 |
| .mcp.json設定 | サーバー起動設定 | 元記事 第3章 |
| Hooks | PreToolUse等のイベント処理 | 元記事 第7章 |
| Permissions | 権限管理 | 元記事 第11章 |
| Agent Teams タスクボード | タスクJSON管理ランタイム | 追記候補_エージェントアーキテクチャ |
| Agent Teams SendMessage | Inbox管理 | 追記候補_エージェントアーキテクチャ |
| LangChain | Tool Use抽象化 | 元記事 第2章 |
| LlamaIndex | RAG + Agent | 元記事 第4章 |
| Strands Agents | AWS Bedrock連携 | 元記事 第2章 |
| LangGraph | グラフベース制御フロー | 元記事 第4章 |
| AutoGen | マルチエージェント | 元記事 第4章 |
| Embedding Model | ベクトル化処理 | 追記候補_概念補完.md |
| Computer Use実行 | 画面操作の実行 | 追記候補_概念補完.md |
| TGI / vLLM / Ollama | モデルサービング | 元記事 第1章 |
| LiteLLM | API統一ラッパー | 元記事 第1章 |

---

### 第4層：外部ツール層

外部サービス・データベース・MCP等の実際のツール実装。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| MCPサーバー | ツール実装・公開プログラム | 元記事 第3章 |
| ベクトルDB | Pinecone, Chroma, pgvector等 | 追記候補_概念補完.md |
| 検索エンジン | Elasticsearch, OpenSearch等 | 追記候補_概念補完.md |
| HuggingFace Hub | モデルリポジトリ | 元記事 第1章 |
| A2A Agent Card | エージェント発見メタデータ | 追記候補_エージェントアーキテクチャ |
| リモートMCPサーバー | HTTP/SSEで公開されるMCP | 元記事 第3章 |
| 画像生成API | DALL-E, Imagen等 | 元記事 第2章 |
| Amazon AgentCore | クラウドエージェント基盤 | 元記事 第8章 |

---

### 第5層：プレゼンテーション層

ユーザーと対話するインターフェース。

| 概念 | 説明 | 参照元 |
|------|------|--------|
| VS Code / Kiro | IDE | 追記A改訂版_4層モデル.md |
| Claude.ai | Webインターフェース | 追記A改訂版_4層モデル.md |
| Claude Code（UI部分） | CLIインターフェース | 元記事 第0章 |
| Cursor（UI部分） | エディタUI | 元記事 第0章 |
| Dify / n8n（UI部分） | ノーコードUI | 追記A改訂版_4層モデル.md |
| OpenAI Codex（UI部分） | CLI/エディタUI | 元記事 第0章 |

---

## 3. 複数層にまたがる概念

以下の概念は複数の層に関与する。

| 概念 | 関与する層 | 説明 |
|------|-----------|------|
| Tool Use全体 | 1, 2A, 2B, 3 | 定義(1), 出力(2B), 結果返却(2A), 実行(3) |
| Subagent | 1, 2A, 2B, 3 | Taskツール呼び出しから結果返却まで全層 |
| Tool型RAG | 1, 2B, 3, 4 | LLM起点(2B)で検索ツール(4)を呼び、結果が戻る |
| Computer Use | 1, 2A, 3 | 定義(1), 実行(3), screenshot返却(2A) |
| MCP | 2A, 3, 4 | クライアント通信(2A), 変換(3), サーバー(4) |
| Claude Code / Cursor | 3, 5 | ランタイム(3)とUI(5)の両面を持つ |
| A2A | 2A, 4 | HTTPリクエスト(2A)と外部エージェント(4) |
| 従来型RAG | 2A, 3 | 注入処理(2A)とパイプライン実行(3) |

---

## 4. 層判定フロー（新技術マッピング用）

新しい概念が出てきたときの層判定基準：

```
Q1. LLMへのリクエスト/レスポンスJSONのフィールド構造か？
    → YES: 第1層（LLM層）

Q2. クライアント/ホストがLLMに能動的に送る通信か？
    → YES: 第2層A（クライアント起点）

Q3. LLMが出力として返す呼び出し要求か？
    → YES: 第2層B（LLM起点）

Q4. LLMを呼び出すランタイム・フレームワークか？
    プログラムが「必ず実行する」を保証する制御か？
    → YES: 第3層（アプリ層）

Q5. 外部サービス・データベース・ツール実装か？
    → YES: 第4層（外部ツール層）

Q6. ユーザーが直接触るインターフェースか？
    → YES: 第5層（プレゼンテーション層）

※ 複数のYES: 複数層にまたがる（上記「複数層にまたがる概念」参照）
```

---

## 5. 旧4層モデルからの移行対応表

| 旧モデル | 新5層モデル | 備考 |
|----------|------------|------|
| ①LLM入出力層 | 第1層（LLM層）+ 第2層（通信層） | 入出力を分離 |
| ②ホスト制御層 | 第3層（アプリ層）+ 第4層（外部ツール層） | 実行者とツールを分離 |
| ③プロンプト層 | 第2層A（クライアント起点）の一部 | 注入はクライアント動作 |
| ④アプリ層（4層版） | 第5層（プレゼンテーション層） | UI層として独立 |

---

## 6. 相性問題の発生箇所（5層版）

| 問題の種類 | 発生層 | 原因 |
|-----------|-------|------|
| APIフォーマット不一致 | 第1層 | ベンダー間のJSON形式差 |
| tool descriptionが貧弱 | 第1層 | LLMがツールを使わない |
| ライブラリのバージョンとAPIのズレ | 第1層, 第3層 | ラッパー層の更新遅れ |
| HookがPermissionより弱い認識 | 第3層 | PreToolUseの設計理解不足 |
| MCPスキーマ不正 | 第2層, 第4層 | サーバー実装のJSONスキーマ誤り |
| CLAUDE.mdが巨大すぎる | 第2層A | コンテキスト汚染 |
| Skillのdescriptionが曖昧 | 第2層A | 自動マッチ失敗 |
| 従来RAGとTool型RAGの混同 | 第1層, 第2層 | LLMが文書の出所を知らない |
| Subagentのtools制限が甘い | 第1層, 第3層 | セキュリティリスク |
| フレームワーク間Agent通信 | 第2層A, 第4層 | A2Aプロトコル未対応 |

---

*本マッピング表は元記事群の内容を5層構造に再分類したものです。*
*各概念の詳細は元ファイルを参照してください。*
